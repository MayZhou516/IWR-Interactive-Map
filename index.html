<html>
<!-- TODOS:
	1. Figure out why ticker text is staying black
	2. Get this on a heroku
	3. Adjust column styling
	4. Get little human svg and make a legend 
	5. Style circle onhovers
	6. Slider drag latency?

 -->
<head>

	<script src="https://d3js.org/d3.v3.min.js"></script>
 	<!-- using v3 rather than v4 because datamaps wont operate without it -->
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script src="js/datamaps.world.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/jquery.gsap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/animation.gsap.js"></script>
	<script src="js/d3.slider.js"></script>
	 
	<link rel="stylesheet" href="css/scroll_style.css" type="text/css">
	<link rel="stylesheet" href="css/scroll_examples.css" type="text/css">
	<link rel="stylesheet" href="css/style.css" type="text/css">
	<link rel="stylesheet" href="css/d3.slider.css" type="text/css">
	<link rel="stylesheet" href="css/foundation.min.css" type="text/css">
	<link rel="stylesheet" href="css/animate.css" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Libre+Baskerville" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Rubik:500" rel="stylesheet">
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/debug.addIndicators.min.js"></script>
</head>


<style type="text/css">
	.panel {
		height: 100%;
		width: 100%;
	}
	.panel.green {
		margin-bottom: 400px
	}
</style>
<section class="panel">
	<h1 class="header"> Tracing Refugees to Ithaca </h1>
	<div class="row">
		 <div id="bubbles" class="small-12 large-7 columns">
		</div>
		<div class="small-12 large-5 columns">
			
			<div class ="description">
			<h1 class="caption"> The Initial Wave</h1>
				<p class="details">Refugee resettlement to Ithaca began at the end of the Vietnam War. Cornell University professors, who had built professional and personal ties while visiting Vietnam, were initially responsible with connecting refugees to resources in Ithaca. Given the historical interest in international affairs and the resources available at Cornell, Ithaca expanded from just an educational gateway community to a “safe haven.” The refugee population also included refugees from all over Southeast Asia, including Cambodia and Loa. 
				</p> 
			</div>
			<div class="numbers">
				<h1>Refugees in Ithaca</h1>
				<div class="littlerefugees"></div>
			</div>
		</div>
	</div>
	<div class="slider">
			<div id= "ordinalScale"></div>
	</div>
</section>
<section class="panel turqoise">
	<b>TWO</b>
</section>
<section class="panel green">
	<b>THREE</b>
</section>
<section class="panel bordeaux">
	<b>FOUR</b>
</section>
<script>
	$(function () { // wait for document ready
		// init
		var controller = new ScrollMagic.Controller({
			globalSceneOptions: {
				triggerHook: 'onLeave'
			}
		});

		// get all slides
		var slides = document.querySelectorAll("section.panel");

		// create scene for every slide
		for (var i=0; i<slides.length; i++) {
			new ScrollMagic.Scene({
					triggerElement: slides[i]
				})
				.setPin(slides[i])
				.addIndicators() // add indicators (requires plugin)
				.addTo(controller);
		}
	});
</script>
	
 	<script>
	var map = new Datamap({
		projection: 'mercator',
	  element: document.getElementById("bubbles"),
	  // done: function(datamap) {
	  //           datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
	            
	  //           	// clears bubbles on each click of a country
	  //           	$('#bubbles g.bubbles').empty();

	  //           	//enables click a country, draw arc from that point to Ithaca
	  //       		console.log("Entering arc drawing");
	  //       		// empty arcs
	  //       		map.arc([]);
	  //       		map.arc([
	  //       		{
	  //       			strokeColor: '#6AE368',
	  //       			origin: geography.id,
	  //       			destination: {
	  //       				// this is Ithaca
	  //       				latitude: '42.4440',
	  //       				longitude: '-76.5019'
	  //       			}	
	  //       		}
	  //   			], {strokeWidth: 1, arcSharpness: 1.4});
	      
	  //           	console.log(geography);
	  //           });
	  //       },

	  geographyConfig: {
	    popupOnHover: false,
	    highlightOnHover: false,
	    highlightFillColor: '#6AE368'
	  },
	  //disables on hover for the bubbles
	  bubblesConfig: {
	  	popupOnHover: false,
	  },
	  fills: {
	  	// sets to black for default
	    defaultFill: '#225D3C',
	    // controls inner colors of the bubbles
	    // SYR: '#EF3054',
	    // AUS: '#EF3054',
	    // IND: '#EF3054',
	    // BRA: '#EF3054'

	  }
	});

	// generates slider
	// little bit of latency due to json load, how to fix????
	events = d3.slider().scale(d3.scale.ordinal().domain(["Tibetan (1970)", "Vietnamese", "Lao & Cambodian", "Boat People", "Amerasian", "Russian", "Tibetan (1990)", "Burmese", "Karen", "Iraqi & Afghan" ]).rangePoints([0, 1], 0.5)).axis(d3.svg.axis()).snap(true).value("NULL");

	//handles slider movement
	d3.select('#ordinalScale').call(events.on("slide", function (evt, value){
		//fill this in with actual data
		data={"Tibetan (1970)":
			{
				name: 'CHN',
				refugees: '10',
				caption:'1970s Tibetan',
				bluemen: 0,
				redmen: 1,
				details:'Tibet is a primarily Buddhist territory that has been governed as an autonomous region of China. In 1950, China sent in thousands of troops to enforce its claim on the region, leading to the exile of the 14th Dalai Lama. Throughout the 1960s and 70s, most of Tibet’s monasteries were destroyed and thousands of Tibetans are believed to have died under period of repressions and Marshall Law.'
			},
			"Vietnamese":
			{
				name: "VNM",
				refugees: "20",
				caption: "1975+ Vietnamese",
				bluemen: 1,
				redmen: 2,
				details:'The Vietnam War represented a  prolonged conflict between the communist government of North Vietnam and the government of South Vietnam and its main ally, the United States. The fall of the Saigon in 1975 lead to a mass exodus of people loyal to Southern Vietnamese forces. By 1977, around 20,000 people fled Vietnam as refugees, and it is estimated that nearly one-third of these people died from starvation, drowning, pirate activities, and being turned away before they could make it to safety. As many as 2 million civilians died at result of the Vietnam War.'
			},
			"Lao & Cambodian":
			{
				name: "LAO",
				refugees: "30",
				caption: "1980s Lao and Cambodian",
				bluemen: 3,
				redmen: 3,
				details:'In 1975, communist Khmer Rouge forces took control over Cambodia, instituting a “radical reconstructuring of the country that lead to the murdering of over 1.5 million Cambodians. After the invasion of the Vietnamese army in 1979, over 100,000 Cambodian refugees fled to resettle in the U.S.'
			},
			"Boat People":
			{
				name: "KHM",
				refugees: "40",
				caption:"1980s Boat People",
				bluemen: 6,
				redmen: 1,
				details: 'In late 1978, tragic wars between Indo-China broke out. Vietnam attacked Kampuchea (Cambodia) and later attacked Chinese forces in the North. The wars caused a rough estimate of 1.5 million people from Vietnam, Cambodia, and Laos to flee their countries. The U.S. accepted approximately 823,000 as a result of these conflicts.'
			},
			"Amerasian":
			{
				name: "VNM",
				refugees: "40",
				caption:"1980s Amerasian",
				bluemen: 7,
				redmen: 2,
				details: 'Over the course of US troop occupation in Vietnam, many American soldiers fathered children from Vietnamese women. The mixed raced children, referred to as "children of the dust",  were detested and subject to extensive mistreatment in Vietnam, as many people saw them as a connection to and reminder of US forces. Vietnam began to pursue aggressive policies to deport the children out of the country.'
			},
			"Russian":
			{
				name: "RUS",
				refugees: "40",
				caption:"1980s/90s: Russian, Ukrainian, Moldovan, etc. (former USSR)",
				bluemen: 9,
				redmen: 1,
				details: 'Members of many religions were persecuted throughout most years of the Soviet Union existence, with clergy members and other believers being killed, jailed, or sent to labor camps.  For example, after 1959, about 12,000 Russian Orthodox Churches were forcibly closed and their members targeted.  The Ukrainian Catholic Church was suppressed because of ties to Ukrainian nationalism.  And Soviet Jews were routinely persecuted during all periods of Soviet history. With the Lautenberg Amendment in 1989, the U.S. Congress opened refugee status to Soviet Jews, Evangelical Christians, Ukrainian Catholics, and Ukrainian Orthodox believers who proved "well-established histories of persecution” in the USSR, and who had family ties or sponsorship in the United States."'
			},

			"Tibetan (1990)":
			{
				name: "CHN",
				refugees: "40",
				caption:"1990s Tibetan",
				bluemen: 10,
				redmen: 1,
				details: 'After hundreds of Tibetans were arrested, imprisoned, and killed by Chinese soldiers during the late 1980s and early 1990s during demonstrations against the Chinese occupation of Tibet, hundreds of Tibetans fled Tibet per year, with 120,000 Tibetans having resettling in India and Nepa through this time period.  The 1990 Immigration Act, although it did not officially call Tibetans refugees because of relations with China, opened 1,000 immigrant visas to “qualified displaced Tibetans,” providing them with permanent residence and work authorization (but no Federal funds or other usual refugee benefits for three years).  The Tibetans were resettled in 10 cluster sites in the U.S., including Ithaca, New York City, San Francisco, and Minneapolis.'
			},
			"Burmese":
			{
				name: "MMR",
				refugees: "40",
				caption:"1990-2000 Burmese (Burman and Other Groups)",
				bluemen: 11,
				redmen: 4,
				details: 'The military government of Burma violently repressed pro-Democracy activists, including many students, intellectuals, and elected officials, after large demonstrations in 1987 and 1988, during which thousands of people demonstrated against the repressive regime. Thousands of people were killed, arrested, tortured, and harassed by the military and police, and by the mid-1990s, hundreds of thousands of people were displaced within Burma and over a million refugees and migrants had escaped to Thailand and other nearby countries.  According to a study of 104 Burmese dissidents in Thailand, 89% had suffered interrogation, 78% had suffered imprisonment, 70% had suffered threats of deportation, and 38% had suffered torture.'
			},

			"Karen":
			{
				name: "MMR",
				refugees: "40",
				caption:"2000s Karen and Other Burmese Ethnic Groups",
				bluemen: 15,
				redmen: 2,
				details: 'Burma has suffered from decades of internal conflict between various ethnic group. In 1990, the government launched a "systematic offensive" against the Eastern Burmese ethnic group, the Karen that led to the summary execution, severe torture, and rape, as well as forced labor, extortion, and displacement of Karen people. It is estimated that over 200,000 Karen people have been driven to flee their home.'
			},

			"Iraqi & Afghan":
			{
				name: "IRQ",
				refugees: "40",
				caption:"2010s Iraqui and Afghan",
				bluemen: 17,
				redmen: 2,
				details: 'The US invasion of Iraq in 2003 caused 1 in 25 Iraqis to be displaced from their homes. By 2015, continued conflict caused 4.4 million Iraqis to be internally displaced, and 2 million were forced to leave the country. Thousands of Iraqis and Afghans also worked with the U.S. military, often facing death threats from insurgents because of this work.  In 2007, the United States created the Special Immigrant Visa (SIV) program to bring up to 50 interpreters and translators to the U.S. per year from these countries.'
			},
		};

		
	//remove and append this ticker's related data
	$('.description').empty();
	$('.description').append("<h1 class='caption'>"+data[value].caption+"</h1><p class='details'>"
		+data[value].details+"<br>Refugees: "+data[value].refugees+"</p>");



	$('.littlerefugees').empty();

	val=data[value].bluemen;	 
	//add little men for numbers of refugees here 
    for(i=0; i<= val; i++){
    	$('.littlerefugees').append("<img class='pic' src='blueman.svg'>");
    };

    for(i=0; i<= data[value].redmen; i++){
    	$('.littlerefugees').append("<img class='pic animated bounceIn' src='redman.svg'>");
    }
    

    console.log(data[value]);

    // clear bubbles
    map.bubbles([]);
    //draw red circle on selected slider val
	map.bubbles([
	{
		name: value,
	    radius: 10,
	    centered: data[value].name,
	    refugees: data[value].refugees,
	    borderColor: '#FF0000',
	    fillKey: data[value].name,
	}
	]
	// on hover, this is what will be displayed
	// {
	//   popupTemplate: function(geo, data) {
	//   	// console.log(data);
	//   	// console.log(data.name);
	//   	// console.log(data.refugees);
	//   	return '<h1>Country Name: '+data.name+'</h1><h3>Number of Refugees: '+ data.refugees+'</h3>';
	//   }
	// }
	);
	// hard fix for Burmese
	if (value=="Burmese"){
		

		 // clear arcs
	    map.arc([]);
	    map.arc([
		{
			strokeColor: '#EF3054',
			origin: {
				latitude: '21.9162',
				longitude: '95.9560'
			},
			destination: {
				// this is Ithaca
				latitude: '40.4440',
				longitude: '-76.5015'
			}	
		}
		], 
		{strokeWidth: 2, arcSharpness: 1.4});
	} else{
	    // clear arcs
	    map.arc([]);
	    //draw green arc from selected slider val to Ithaca
	    map.arc([
		{
			strokeColor: '#EF3054',
			origin: data[value].name,
			destination: {
				// this is Ithaca
				latitude: '42.4440',
				longitude: '-76.5019'
			}	
		}
		], 
		{strokeWidth: 2, arcSharpness: 1.4});
    }


}));
</script>
</body>

</html>
