<html>
<!-- TODOS:
	1. Figure out why ticker text is staying black
	2. Get this on a heroku
	3. Adjust column styling
	4. Get little human svg and make a legend 
	5. Style circle onhovers
	6. Slider drag latency?

 -->
<head>

	<script src="https://d3js.org/d3.v3.min.js"></script>
 	<!-- using v3 rather than v4 because datamaps wont operate without it -->
	<script src="http://d3js.org/topojson.v2.min.js"></script>
	<script src="js/datamaps.world.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/jquery.gsap.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/animation.gsap.js"></script>
	<script src="js/d3.slider.js"></script>
	 
	<link rel="stylesheet" href="css/scroll_style.css" type="text/css">
	<link rel="stylesheet" href="css/scroll_examples.css" type="text/css">
	<link rel="stylesheet" href="css/style.css" type="text/css">
	<link rel="stylesheet" href="css/d3.slider.css" type="text/css">
	<link rel="stylesheet" href="css/foundation.min.css" type="text/css">
	<link rel="stylesheet" href="css/animate.css" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Libre+Baskerville" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Rubik:500" rel="stylesheet">
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/debug.addIndicators.min.js"></script>
</head>


<style type="text/css">
	.panel {
		height: 100%;
		width: 100%;
	}
	.panel.green {
		margin-bottom: 400px
	}
</style>
<section class="panel">
	<h1 class="header"> Ithaca Through Refugees </h1>
	<div class="row">
		 <div id="bubbles" class="small-12 large-7 columns">
		</div>
		<div class="small-12 large-5 columns">
			
			<div class ="description">
			<h1 class="caption"> 1990 Bosnia conflict </h1>
				<p class="details">Taking it slow, but it's not typicalHe already knows that my love is fire His heart was a stone, but then his hands roamed I turned him to gold and it took him higher Well, I'll be your daydream, I'll be your favorite things We could be beautiful Get drunk on the good life, I'll take you to paradise Say you'll never let me go Deep in my bones, I can feel you Take me back to a time only we knew Hideaway We could waste the night with an old film Smoke a little weed on the couch in the back room Hideaway Say you'll never let me go Say you'll never let me go Ah, ah, ah Ah, ah, ah Ah, ah, ah Say you'll never let me go Say you'll never let me go Say you'll never let me go Say you'll never let me go Deep in my bones, I can feel you Take me back to a time only we knew Hideaway We could waste the night with an old film Smoke a little weed on the couch in the back room Hideaway Say you'll never let me go Say you'll never let me go
				<br> <br>sfljdshjl </p> 
			</div>
			<div class="littlerefugees"></div>
		</div>
	</div>
	<div class="slider">
			<div id= "ordinalScale"></div>
	</div>
</section>
<section class="panel turqoise">
	<b>TWO</b>
</section>
<section class="panel green">
	<b>THREE</b>
</section>
<section class="panel bordeaux">
	<b>FOUR</b>
</section>
<script>
	$(function () { // wait for document ready
		// init
		var controller = new ScrollMagic.Controller({
			globalSceneOptions: {
				triggerHook: 'onLeave'
			}
		});

		// get all slides
		var slides = document.querySelectorAll("section.panel");

		// create scene for every slide
		for (var i=0; i<slides.length; i++) {
			new ScrollMagic.Scene({
					triggerElement: slides[i]
				})
				.setPin(slides[i])
				.addIndicators() // add indicators (requires plugin)
				.addTo(controller);
		}
	});
</script>
	
 	<script>
	var map = new Datamap({
		projection: 'mercator',
	  element: document.getElementById("bubbles"),
	  // done: function(datamap) {
	  //           datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
	            
	  //           	// clears bubbles on each click of a country
	  //           	$('#bubbles g.bubbles').empty();

	  //           	//enables click a country, draw arc from that point to Ithaca
	  //       		console.log("Entering arc drawing");
	  //       		// empty arcs
	  //       		map.arc([]);
	  //       		map.arc([
	  //       		{
	  //       			strokeColor: '#6AE368',
	  //       			origin: geography.id,
	  //       			destination: {
	  //       				// this is Ithaca
	  //       				latitude: '42.4440',
	  //       				longitude: '-76.5019'
	  //       			}	
	  //       		}
	  //   			], {strokeWidth: 1, arcSharpness: 1.4});
	      
	  //           	console.log(geography);
	  //           });
	  //       },

	  geographyConfig: {
	    popupOnHover: false,
	    highlightOnHover: false,
	    highlightFillColor: '#6AE368'
	  },
	  //disables on hover for the bubbles
	  bubblesConfig: {
	  	popupOnHover: false,
	  },
	  fills: {
	  	// sets to black for default
	    defaultFill: '#225D3C',
	    // controls inner colors of the bubbles
	    // SYR: '#EF3054',
	    // AUS: '#EF3054',
	    // IND: '#EF3054',
	    // BRA: '#EF3054'

	  }
	});

	// generates slider
	// little bit of latency due to json load, how to fix????
	events = d3.slider().scale(d3.scale.ordinal().domain(["NULL", "Tibet", "Vietnam", "Laos and Cambodia", "Boat People"]).rangePoints([0, 1], 0.5)).axis(d3.svg.axis()).snap(true).value("NULL");

	//handles slider movement
	d3.select('#ordinalScale').call(events.on("slide", function (evt, value){
		//fill this in with actual data
		data={"Tibet":
			{
				name: 'CHN',
				refugees: '10',
				caption:'1970s Tibet',
				bluemen: 20,
				redmen: 10,
				details:'Tibet is a primarily Buddhist territory that has been governed as an autonomous region of China. In 1950, China sent in thousands of troops to enforce its claim on the region, leading to the exile of the 14th Dalai Lama. Throughout the 1960s and 70s, most of Tibet’s monasteries were destroyed and thousands of Tibetans are believed to have died under period of repressions and Marshall Law'
			},
			"Vietnam":
			{
				name: "VNM",
				refugees: "20",
				caption: "1975+ Vietnam",
				bluemen: 30,
				redmen: 20,
				details:'The Vietnam War represented a  prolonged conflict between the communist government of North Vietnam and the government of South Vietnam and its main ally, the United States. The fall of the Saigon in 1975 lead to a mass exodus of people loyal to Southern Vietnamese forces. By 1977, around 20,000 people fled Vietnam as refugees, and it is estimated that nearly one-third of these people died from starvation, drowning, pirate activities, and being turned away before they could make it to safety. As many as 2 million civilians died at result of the Vietnam War.'
			},
			"Laos and Cambodia":
			{
				name: "LAO",
				refugees: "30",
				caption: "1980s Laos and Cambodia",
				bluemen: 50,
				redmen: 5,
				details:'In 1975, communist Khmer Rouge forces took control over Cambodia, instituting a “radical reconstructuring” of the country that lead to the murdering of over 1.5 million Cambodians. After the invasion of the Vietnamese army in 1979, over 100,000 Cambodian refugees fled to resettle in the U.S.'
			},
			"Boat People":
			{
				name: "VNM",
				refugees: "40",
				caption:"1980s Boat People",
				bluemen: 55,
				redmen: 30,
				details: 'In late 1978, tragic wars between Indo-China broke out. Vietnam attacked Kampuchea (Cambodia) and later attacked Chinese forces in the North. The wars caused a rough estimate of 1.5 million people from Vietnam, Cambodia, and Laos to flee their countries. The U.S. accepted approximately 823,000 as a result of these conflicts.'
			}
		};

		
	//remove and append this ticker's related data
	$('.description').empty();
	$('.description').append("<h1 class='caption'>"+data[value].caption+"</h1><p class='details'>"
		+data[value].details+"<br>Name: "+value+"<br>Refugees: "+data[value].refugees+"</p>");



	$('.littlerefugees').empty();

	val=data[value].bluemen;	 
	//add little men for numbers of refugees here 
    for(i=0; i<= val; i++){
    	$('.littlerefugees').append("<img class='pic' src='blueman.svg'>");
    };

    for(i=0; i<= data[value].redmen; i++){
    	$('.littlerefugees').append("<img class='pic animated bounceIn' src='redman.svg'>");
    }
    

    console.log(data[value]);


    // clear arcs
    map.arc([]);
    //draw green arc from selected slider val to Ithaca
    map.arc([
	{
		strokeColor: '#EF3054',
		origin: data[value].name,
		destination: {
			// this is Ithaca
			latitude: '42.4440',
			longitude: '-76.5019'
		}	
	}
	], 
	{strokeWidth: 2, arcSharpness: 1.4});
    // clear bubbles
    map.bubbles([]);
    //draw red circle on selected slider val
	map.bubbles([
	{
		name: value,
	    radius: 10,
	    centered: data[value].name,
	    refugees: data[value].refugees,
	    borderColor: '#FF0000',
	    fillKey: data[value].name,
	}
	]
	// on hover, this is what will be displayed
	// {
	//   popupTemplate: function(geo, data) {
	//   	// console.log(data);
	//   	// console.log(data.name);
	//   	// console.log(data.refugees);
	//   	return '<h1>Country Name: '+data.name+'</h1><h3>Number of Refugees: '+ data.refugees+'</h3>';
	//   }
	// }
	);

}));
</script>
</body>

</html>
